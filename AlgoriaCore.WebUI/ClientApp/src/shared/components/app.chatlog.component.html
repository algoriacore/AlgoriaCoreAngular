
<style>

    .chatbox {
        height: 320px;
        background: #fff;
        border: 1px solid #dee2e6;
        overflow: scroll;
    }

    .chatitem {
        margin-top: 30px;
        padding: 20px;
        overflow: hidden;
        font-family: arial, helvetica;
        color: #333;
        text-shadow: 0.1em 0em 0.3em #bbb;
    }
    .chatitem-content {
        display:inline-block;
    }

    .chatitem-title-name {
        font-weight: bold;
        display: inline-block;
        margin-bottom:5px;
    }
    .chatitem-title-user {
        display: inline-block;
        margin-bottom: 5px;
    }
    .chatitem-title-time {
        display: inline-block;
        margin-bottom: 5px;
    }
    .chatitem-title-sep {
        display: inline-block;
        content: " ";
        background: #ccc;
        width: 6px;
        height: 6px;
        margin: 0px 15px;
        border-radius: 6px;
        margin-bottom: 5px;
    }

    .chatitem-text{

    }
    .chatitem-text p {
        margin:0;
    }

    .chatitem-file{
        cursor:pointer;
    }

</style>

<app-blockable-div #pblockableDiv>

    <div class="grid" [style.display]="isReady && !isSeeAttachments ? 'block': 'none'">
        <div class="col-12" style="border: solid 1px #c8c8c8; border-bottom: 0px;">
            <div style="float: left; display: inline;">
                <h5><i class="fa fa-fw fa-commenting" aria-hidden="true" (mouseenter)="op.show($event)"></i>&nbsp;{{chatRoom.name}}</h5>
            </div>
            <div style="float: right; display: inline;">
                <p-button type="button" label="{{l('Files')}}" (onClick)="openAttachmentWindow(attachmentWindow, $event)"></p-button>
            </div>
            <div class="clearfix"></div>
        </div>
        <div class="col-12" style="padding: 0px;">
            <div style="width: 100%;">
                <!--<ck-editor #ckeContentArea skin="moono-lisa"
               language="es-MX"
               [config]="configContentAreaObject">
    </ck-editor>-->
                <!--<p-editor #ckeContentArea
              name="contentArea"
              (onInit)="contentAreaOnInit($event)"
              [style]="{'height':'320px'}">
    </p-editor>-->
                <!--<div #chatContent id="chatContent"
         class="chatbox"
         (scroll)="onScroll($event)"
         [innerHTML]="chatHTML">-->

                <div class="chatbox">
                    <p-virtualScroller [value]="allMessages" scrollHeight="500px" [itemSize]="150"
                                [lazy]="true" (onLazyLoad)="loadMessages($event)">
                        <ng-template pTemplate="item" let-msg>
                        
                            <div class="chatitem">
                                <!--<div style="width:90px;display:inline-block;float:left;">
                                    <img src="{{getUrlUserPicture(msg.user)}}" alt="" style="border-radius: 64px; width: 64px; height: 64px;" />
                                </div>-->
                                <div class="chatitem-content">
                                    <div class="chatitem-title-name">{{msg.userDesc}}</div>
                                    <div class="chatitem-title-sep"></div>
                                    <div class="chatitem-title-user">{{msg.id}}</div>
                                    <div class="chatitem-title-sep"></div>
                                    <div class="chatitem-title-user">{{dateTimeService.getDateTimeToDisplay(msg.creationTime)}}</div>
                                    <div class="chatitem-text">{{msg.comment}}{{getAttachementHTMLSection(msg.files)}}</div>
                                </div>
                            </div>
                        </ng-template>
                        <!--<ng-template pTemplate="loader" let-scrollOptions="options">
                            <p [ngClass]="{'odd': options.odd}" style="height: 50px;">
                                Loading...
                            </p>
                        </ng-template>-->
                    </p-virtualScroller>
                </div>
            </div>
        </div>
        <div class="col-12" style="border: solid 1px #c8c8c8; border-bottom: 0px; border-top: 0px;">

            <p-fileUpload #fileUpload
                          name="fileUpload[]"
                          multiple="multiple"
                          customUpload="true"
                          maxFileSize="10000000"
                          chooseLabel="{{l('AttachFile')}}"
                          cancelLabel="{{l('Cancel')}}"
                          [showUploadButton]="false">
            </p-fileUpload>

        </div>
        <div class="col-12" style="padding: 0px;">
            <div class="p-inputgroup">
                <div style="width: 100%;">
                    <p-editor #ckeInputMessage
                              name="editor1"
                              (onInit)="editorOnInit($event)"
                              [style]="{'height':'120px'}">
                    </p-editor>
                </div>
                <button pButton pRipple type="button" icon="fa fa-paper-plane" style="max-width: 80px; min-width: 60px;" (click)="sendMessage()"></button>
            </div>
        </div>
    </div>

</app-blockable-div>

<p-blockUI [target]="pblockableDiv" [blocked]="blocked">
    <i class="fa fa-circle-o-notch" aria-hidden="true" style="position:absolute;top:50%;left:50%;font-size: 60px;font-weight: bold"></i>
</p-blockUI>

<p-overlayPanel #op [showCloseIcon]="true" [dismissable]="true">
    {{chatRoom.description}}
    <br />
    {{chatRoom.userCreatorDesc}}
    <br />
    {{dateTimeService.getDateTimeToDisplay(chatRoom.creationTime)}}
</p-overlayPanel>

<p-overlayPanel #attachmentWindow [showCloseIcon]="true" [dismissable]="true" (onShow)="isAttachmentWindowOpen = true" (onHide)="isAttachmentWindowOpen = false">
    <app-blockable-div #attachmentWindowBlockable>
        <div #attachmentWindowList style="width: 350px; max-height: 500px; overflow-y: auto;" (scroll)="onScrollAttachmentWindow($event);"></div>
    </app-blockable-div>
</p-overlayPanel>

<p-blockUI [target]="attachmentWindowBlockable" [blocked]="attachmentWindowBlocked">
    <i class="fa fa-circle-o-notch" aria-hidden="true" style="position:absolute;top:50%;left:50%;font-size: 60px;font-weight: bold"></i>
</p-blockUI>
